

    


    


    


    


<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8" />
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>RRDTool пример использования в python &mdash; Ural penguins</title>
    

    
        <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    

    
        
    
            <link rel="index" title="Алфавитный указатель" href="../../../genindex/"/>
            <link rel="search" title="Поиск" href="../../../search/"/>

        <link rel="top" title="Ural penguins" href="../../../"/>

    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800,300&subset=latin,cyrillic,cyrillic-ext" rel="stylesheet" type="text/css" />

    <link href="../../../_static/css/badge_only.css" type="text/css" rel="stylesheet" />
    <link href="../../../_static/css/__theme.css" type="text/css" rel="stylesheet" />

    
            <script type="text/javascript" src="../../../_static/jquery.js"></script>
            <script type="text/javascript" src="../../../_static/underscore.js"></script>
            <script type="text/javascript" src="../../../_static/doctools.js"></script>
            <script type="text/javascript" src="../../../_static/metrika.js"></script>
            <script type="text/javascript" src="../../../_static/translations.js"></script>
    
  
  <style type="text/css">
    html, body {
      background: #545d5c !important;
    }
    .page__left .menu {
        width: 0px;
    }
    .page__right {
      background-color: #e7e7e7;
      margin: 0 0 0 30px;
    }
    .rst-content {
      padding: 13px;
    }
    .footer {
      padding: 13px;
    }
    /* unvisited link */
    ul.postlist-style-none a:link, .head a:link {
        color: #222;
        text-decoration: none;
    }

    /* visited link */
    ul.postlist-style-none a:visited, .head a:visited {
        color: #222;
        text-decoration: none;
    }

    /* mouse over link */
    ul.postlist-style-none a:hover, .head a:hover {
        color: #222;
        text-decoration: none;
    }

    ul.postlist-style-none a:active, .head a:active {
        color: #222;
        text-decoration: none;
    }
    ul.postlist-style-none li {
        list-style-type: none;
    }
    ul.postlist-style-none li p.first {
      color: red !important;
      font: 1.8em "Open Sans",Arial,sans-serif !important;
    }
    .first a {
      font-weight: bold;
    }
    .first em {
      font-style: normal !important;
    }
    .wrapper__inner {
      padding: 0px 30px 0 0 !important;
    }
    .strike {
      text-decoration: line-through;
    }
  </style>

  
  
  <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.post-list-style-disc {list-style-type: disc;}
    ul.post-list-style-none {list-style-type: none;}
    ul.post-list-style-circle {list-style-type: circle;}
  </style>

</head>

<body>
    <div class="wrapper">
        <div class="wrapper__inner">
            <div class="page
                ">
                <div class="page__left">
                  
                    <nav class="menu" id="menu" data-state="expand">
                        <div class="menu-inner">
                            
                                <div class="menu-project">
                                    <a href="../../../" class="menu-project__link">Ural penguins</a>
                                </div>
                            
                            <div class="tree">
                                
                                
                                    <ul>
<li><a class="reference internal" href="#">RRDTool пример использования в python</a><ul>
<li><a class="reference internal" href="#id1">Создаем файл</a></li>
<li><a class="reference internal" href="#id2">Вносим данные</a></li>
<li><a class="reference internal" href="#png">Создаем график в png</a></li>
<li><a class="reference internal" href="#backup-restore">Backup и Restore</a></li>
</ul>
</li>
</ul>

                                
                            </div>
                            <div class="menu-search search">
                                <div class="search-title">Quick search</div>
                                <form id="search-form" class="search-form" action="../../../search/" method="GET">
                                    <input type="text" name="q" placeholder="Search docs" />
                                    <input type="hidden" name="check_keywords" value="yes" />
                                    <input type="hidden" name="area" value="default" />
                                </form>
                                <div class="search-desc">Enter search terms or a module, class or function name.</div>
                            </div>
                            <nav class="wy-nav-side">&nbsp;</nav>
                        </div>
                        <div class="menu-switch">
                            <div class="menu-switch__arrow">«</div>
                        </div>
                    </nav>
                  
                </div>

                <section class="page__right">
                    
  <div class="head" style="background-image: url('/_static/bg.jpg');
                  background-size: 100%;
                  background-repeat: no-repeat;
                  height: 200px">
    <a href="/">
      <div style="width:100%; height: 75%">
        <h1 style="padding-top:15px;padding-left:15px;font-size:60px">Ural penguins</h1>
      </div>
    </a>
    <table style="
        border-collapse: unset !important;
        border-spacing: 1 !important;">
        <tr>
            <td style="padding-right: 2px">
                <a href="/pages/pyramid/index.html">
                    <div style="background: white;width:100px;height:50px;line-height:50px;text-align:center;"
                        onmouseover="this.style.background='lightgrey';" onmouseout="this.style.background='white';">
                        Pyramid
                    </div>
                </a>
            </td>
            <td>
                <a href="/pages/nixos/index.html">
                    <div style="background: white;width:100px;height:50px;line-height:50px;text-align:center;"
                        onmouseover="this.style.background='lightgrey';" onmouseout="this.style.background='white';">
                        NixOS
                    </div>
                </a>
            </td>
        </tr>
    </table>
  </div>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <div class="badge" style="width:100%;height:80px">
    <!-- uralbash.ru -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-2884502571619359"
         data-ad-slot="9876011339"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    </div>

                    <div class="badge">
                        
                        
                    </div>

                    <div class="rst-content">
                        
  <script type="text/javascript" src="//yastatic.net/share/share.js" charset="utf-8"></script>
  <table>
    <tr>
      <td>
        <div class="yashare-auto-init" data-yashareL10n="ru"
          data-yashareType="medium"
          data-yashareQuickServices="vkontakte,facebook,twitter,odnoklassniki,moimir,gplus"
          data-yashareTheme="counter"></div>
      </td>
      <td>
        
  
  
    
      <div style="fint-size: 14pt;padding-left: 10pt;display:inline;">
        Apr 11, 2012
      </div>
    
    
      <div style="fint-size: 14pt;padding-left: 10pt;display:inline;">
      
        
          <i class="fa-fw fa fa-tags"></i>
        
        
      
        
        <a href="../../../blog/tag/python/">Python</a>,
        
      
        
        <a href="../../../blog/tag/rrdtool/">RRDTool</a>
        
      
      </div>
    

      </td>
    </tr>
  </table>
  <div class="section" id="rrdtool-python">
<h1>RRDTool пример использования в python<a class="headerlink" href="#rrdtool-python" title="Ссылка на этот заголовок">¶</a></h1>
<p><a class="reference external" href="http://oss.oetiker.ch/rrdtool/">RRDtool</a> (<cite>Round Robin Database</cite>). Обеспечивает хранение и отображение данных
мониторинга (загрузка каналов, температура и любая другая зависящая от времени
последовательность данных, которую можно получить некоторым способом).
Задумывалась как повторная, но более правильная реализация MRTG. Объём хранимых
данных не увеличивается со временем (ячейки хранения используются циклически).
Использование различных функций консолидации данных позволяет охватывать
большие интервалы времени без чрезмерного увеличения объема БД за счет снижения
разрешающей способности. В отличие от mrtg, программа не упаковывает старые
данные самостоятельно, это надо предусматривать при проектировании БД. Сбор
информации и генерация HTML-кода также производится с помощью внешних средств.
Более мощные средства генерации графиков. Все времена во внутреннем формате
Unix (число секунд с 1 января 1970 в UTC). Значения счетчиков могут быть целыми
или вещественными числами или специальным значением UNKNOWN. Лицензия - GPL (но
автор не будет против, если в благодарность послать ему CD/DVD из указанного им
списка; при установке rrdtool имитируется заказ CD на amazone.com ;-).
Необходимо иметь perl 5 (без perl rrdtool соберется, но не будет модулей
подержки perl) и обычный набор средств компиляции (make, gcc, autoconf,
automake, libtool). Имеется также поддержка tcl и python. Нельзя использовать
для учета и биллинга - слишком много он усредняет и сглаживает, используя
достаточно сложные алгоритмы.</p>
<p>Очень хорошее описание <a class="reference external" href="http://www.bog.pp.ru/work/rrdtool.html#at">http://www.bog.pp.ru/work/rrdtool.html#at</a></p>
<div class="section" id="id1">
<h2>Создаем файл<a class="headerlink" href="#id1" title="Ссылка на этот заголовок">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">rrd_file</span> <span class="o">=</span> <span class="s2">&quot;/usr/local/www/nagios/2week.rrd&quot;</span>
<span class="k">def</span> <span class="nf">rrd_create</span><span class="p">(</span><span class="n">rrd_file</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rrd_file</span><span class="p">):</span>
        <span class="n">rrdtool</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">rrd_file</span><span class="p">,</span>
                        <span class="s2">&quot;--step&quot;</span><span class="p">,</span> <span class="s2">&quot;86400&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;DS:available:GAUGE:172800:0.0:100.0&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;RRA:AVERAGE:0.5:1:366&quot;</span><span class="p">,</span>
                       <span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">step</span></code> - интервал через который будут обновляться значения. У нас 86400 сек - это 1 день т.е. ежедневно.</div>
<div class="line"><code class="docutils literal"><span class="pre">DS:available:GAUGE:172800:0:100</span></code> - источник данных</div>
<div class="line"><code class="docutils literal"><span class="pre">available</span></code> - название источника</div>
<div class="line"><code class="docutils literal"><span class="pre">GAUGE</span></code> - тип (в данном случае поддерживает числа с плавающей точкой)</div>
<div class="line"><code class="docutils literal"><span class="pre">172800</span></code> - значение которое должно быть 2*step :)</div>
<div class="line"><code class="docutils literal"><span class="pre">0:100</span></code> - интервал допустимых значений</div>
<div class="line"><br /></div>
<div class="line"><code class="docutils literal"><span class="pre">RRA:AVERAGE:0.5:1:366</span></code> - архив значений</div>
<div class="line"><code class="docutils literal"><span class="pre">AVERAGE</span></code> - тип (в данном случае среднее значение)</div>
<div class="line"><code class="docutils literal"><span class="pre">1:366</span></code> - означает что в архиве 366 записей с интервалом 1*step</div>
</div>
</div>
<div class="section" id="id2">
<h2>Вносим данные<a class="headerlink" href="#id2" title="Ссылка на этот заголовок">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rrd_update</span><span class="p">(</span><span class="n">rrd_file</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">rrdtool</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rrd_file</span><span class="p">,</span> <span class="s2">&quot;N:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">N</span></code> - означает на текущее время (<code class="docutils literal"><span class="pre">Now</span></code>)</div>
<div class="line">через двоеточие указываются значения <code class="docutils literal"><span class="pre">DS</span></code> (В случае нескольких <code class="docutils literal"><span class="pre">DS</span></code> могло быть так <code class="docutils literal"><span class="pre">N:%s:%s:%s</span></code>)</div>
</div>
</div>
<div class="section" id="png">
<h2>Создаем график в png<a class="headerlink" href="#png" title="Ссылка на этот заголовок">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="n">fd</span><span class="p">,</span><span class="n">path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
<span class="n">rrdtool</span><span class="o">.</span><span class="n">graph</span><span class="p">(</span><span class="s2">&quot;/tmp/net.png&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--imgformat&quot;</span><span class="p">,</span> <span class="s2">&quot;PNG&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--height&quot;</span><span class="p">,</span> <span class="s2">&quot;250&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--width&quot;</span><span class="p">,</span> <span class="s2">&quot;550&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--end&quot;</span><span class="p">,</span> <span class="s2">&quot;now&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--start&quot;</span><span class="p">,</span> <span class="s2">&quot;end-2w-1h&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--lower-limit&quot;</span><span class="p">,</span> <span class="s2">&quot;99.3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--upper-limit&quot;</span><span class="p">,</span> <span class="s2">&quot;100.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--zoom&quot;</span><span class="p">,</span> <span class="s2">&quot;1.5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--y-grid&quot;</span><span class="p">,</span> <span class="s2">&quot;0.05:1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--x-grid=DAY:1:DAY:1:DAY:2:0:%a&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--right-axis&quot;</span><span class="p">,</span> <span class="s2">&quot;1:0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--right-axis-format&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%0.2lf%%</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--slope-mode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--vertical-label=Up times/day&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DEF:avl=</span><span class="si">%s</span><span class="s2">:available:AVERAGE&quot;</span> <span class="o">%</span> <span class="n">rrd_file</span><span class="p">,</span>
            <span class="s2">&quot;AREA:avl#00FF00:Up times(%)&quot;</span><span class="p">,</span>
            <span class="s1">&#39;GPRINT:avl:AVERAGE:avg\: </span><span class="si">%2.2lf%%</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Описание всех параметров есть в ссылке приведенной выше.</p>
</div>
<div class="section" id="backup-restore">
<h2>Backup и Restore<a class="headerlink" href="#backup-restore" title="Ссылка на этот заголовок">¶</a></h2>
<p>Фаил <a class="reference external" href="http://oss.oetiker.ch/rrdtool/">rrd</a> платформо зависим и может не заработать на другом железе или
ОС (например из 32бит в 64бит), поэтому принято хранить бэкапы в xml.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ rrdtool dump файл.rrd &gt; бэкап.xml
</pre></div>
</div>
<p>XML можно править вручную и залить обратно в <a class="reference external" href="http://oss.oetiker.ch/rrdtool/">rrd</a>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ rrdtool restore бэкап.xml &gt; файл.rrd
</pre></div>
</div>
<p>Результат:</p>
<div class="figure align-center" id="id3">
<img alt="../../../_images/rrdtool.png" src="../../../_images/rrdtool.png" />
<p class="caption"><span class="caption-text">rrdtool пример графика</span></p>
</div>
<p>Для обучения лучше выбрать меньший интервал чем 1 день, например 2 мин (step = 120).</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../sa_big_table/">
    <i class="fa fa-arrow-circle-left"></i>
    SQLAlchemy и большие таблицы (Memory error)
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../sphinx_github/">
    Хостим документацию Sphinx на github
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <br />
    <script type="text/javascript" src="//yastatic.net/share/share.js" charset="utf-8"></script><div class="yashare-auto-init" data-yashareL10n="ru" data-yashareType="medium" data-yashareQuickServices="vkontakte,facebook,twitter,odnoklassniki,moimir,gplus" data-yashareTheme="counter"></div>
    <h2>Comments</h2>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'uralbash'; // required: replace example with your forum shortname
        var disqus_identifier = '/articles/2012/rrdtool/';
        var disqus_title = 'RRDTool пример использования в python';
        
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

                    </div>
                    <footer class="footer">
                      
  
                        
    <div class="footer__copyright">
            
                &copy; Copyright 2022, uralbash.
            
    </div>
<div class="footer__theme">
    <a href="https://github.com/ITCase/itcase_sphinx_theme" class="footer__theme-link">
      ITCase Sphinx Theme
    </a>
      <span class="footer__theme-text">
          | version: 0.2.0
      </span>
</div>
                      
  <div class="footer__theme">
      <a href="https://github.com/sunpy/ablog" class="footer__theme-link">
        Ablog powered.
      </a>
  </div>
  <div class="footer__theme">
      <a href="http://uralbash.ru/blog/atom.xml" class="footer__theme-link">
        RSS/Atom
      </a>
  </div>
  <div class="footer__theme">
      <a href="https://uralbash.blogspot.com" class="footer__theme-link">
        Старый блог
      </a>
  </div>

                    </footer>
                </section>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        
            var STICKY_MENU = true;
        
    </script>

    <script type="text/javascript" src="../../../_static/js/__theme.js"></script>

    
        <script type="text/javascript">
            var DOCUMENTATION_OPTIONS = {
                    URL_ROOT: '../../../',
                    VERSION: '',
                    COLLAPSE_INDEX: false,
                    FILE_SUFFIX: '',
                    HAS_SOURCE: true
            };
        </script>
    

    
</body>
</html>